<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, button {
            padding: 8px;
            margin: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <h1>Test API BookLend</h1>
    
    <div class="test-section">
        <h2>Test Register</h2>
        <div class="form-group">
            <label>Username:</label>
            <input type="text" id="regUsername" placeholder="testuser">
        </div>
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="regEmail" placeholder="test@gmail.com">
        </div>
        <div class="form-group">
            <label>Full Name:</label>
            <input type="text" id="regFullName" placeholder="Test User">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="regPassword" placeholder="test123">
        </div>
        <div class="form-group">
            <label>Confirm Password:</label>
            <input type="password" id="regConfirmPassword" placeholder="test123">
        </div>
        <button onclick="testRegister()">Test Register</button>
        <div id="registerResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Test Login</h2>
        <div class="form-group">
            <label>Username:</label>
            <input type="text" id="loginUsername" placeholder="testaccount">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="loginPassword" placeholder="test123">
        </div>
        <button onclick="testLogin()">Test Login</button>
        <div id="loginResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Current Token & User</h2>
        <button onclick="showCurrentAuth()">Show Current Auth</button>
        <div id="authResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Test Logout</h2>
        <button onclick="testLogout()">Test Logout</button>
        <div id="logoutResult" class="result" style="display: none;"></div>
    </div>

    <script src="js/api.js"></script>
    <script>
        async function testRegister() {
            const resultDiv = document.getElementById('registerResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Đang đăng ký...';

            try {
                const userData = {
                    username: document.getElementById('regUsername').value,
                    email: document.getElementById('regEmail').value,
                    fullName: document.getElementById('regFullName').value,
                    password: document.getElementById('regPassword').value,
                    confirmPassword: document.getElementById('regConfirmPassword').value
                };

                const result = await api.register(userData);
                resultDiv.className = 'result success';
                resultDiv.textContent = 'Đăng ký thành công:\n' + JSON.stringify(result, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Lỗi đăng ký:\n' + error.message;
            }
        }

        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Đang đăng nhập...';

            try {
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;

                const result = await api.login(username, password);
                resultDiv.className = 'result success';
                resultDiv.textContent = 'Đăng nhập thành công:\n' + JSON.stringify(result, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Lỗi đăng nhập:\n' + error.message;
            }
        }

        function showCurrentAuth() {
            const resultDiv = document.getElementById('authResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';

            const token = localStorage.getItem('authToken');
            const user = localStorage.getItem('currentUser');

            const authInfo = {
                token: token,
                user: user ? JSON.parse(user) : null,
                isAuthenticated: api.isAuthenticated(),
                isAdmin: api.isAdmin()
            };

            resultDiv.textContent = 'Thông tin auth hiện tại:\n' + JSON.stringify(authInfo, null, 2);
        }

        async function testLogout() {
            const resultDiv = document.getElementById('logoutResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Đang đăng xuất...';

            try {
                await api.logout();
                resultDiv.className = 'result success';
                resultDiv.textContent = 'Đăng xuất thành công';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'Lỗi đăng xuất:\n' + error.message;
            }
        }

        // Set default values
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('regUsername').value = 'testuser';
            document.getElementById('regEmail').value = 'test@gmail.com';
            document.getElementById('regFullName').value = 'Test User';
            document.getElementById('regPassword').value = 'test123';
            document.getElementById('regConfirmPassword').value = 'test123';
            
            document.getElementById('loginUsername').value = 'testaccount';
            document.getElementById('loginPassword').value = 'test123';
        });
    </script>
</body>
</html>
